{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Applications/PRINCE/PROJECTS/Hisaab/hisaab-v2/lib/auth.ts"],"sourcesContent":["import * as admin from 'firebase-admin';\n\nif (!admin.apps.length) {\n  admin.initializeApp({\n    credential: admin.credential.cert({\n      projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\n      privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n'),\n    }),\n  });\n}\n\nexport const verifyIdToken = async (token: string) => {\n  try {\n    const decodedToken = await admin.auth().verifyIdToken(token);\n    return decodedToken;\n  } catch (error) {\n    console.error(\"Token verification failed:\", error);\n    return null;\n  }\n};\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,CAAC,2MAAU,CAAC,MAAM,EAAE;IACtB,oNAAmB,CAAC;QAClB,YAAY,iNAAgB,CAAC,IAAI,CAAC;YAChC,SAAS;YACT,aAAa,QAAQ,GAAG,CAAC,qBAAqB;YAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;QAChE;IACF;AACF;AAEO,MAAM,gBAAgB,OAAO;IAClC,IAAI;QACF,MAAM,eAAe,MAAM,2MAAU,GAAG,aAAa,CAAC;QACtD,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;AACF"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Applications/PRINCE/PROJECTS/Hisaab/hisaab-v2/lib/adminAuth.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport { verifyIdToken } from './auth';\n\nexport async function verifyAdminAccess(req: NextRequest) {\n  // 1. Check Master Key\n  const adminKey = req.headers.get('x-admin-key');\n  if (adminKey && adminKey === process.env.ADMIN_KEY) {\n    return { type: 'master' };\n  }\n\n  // 2. Check User Token (Optional, for regular admins if we have them)\n  const authHeader = req.headers.get('Authorization');\n  if (authHeader?.startsWith('Bearer ')) {\n    const token = authHeader.split('Bearer ')[1];\n    const user = await verifyIdToken(token);\n    // TODO: if (user && user.email === 'admin@example.com') return { type: 'user', user };\n    // For now, only Master Key allows \"Master Panel\" access without strict user role check\n    if (user) {\n         // Return user, but strictly speaking \"Master Panel\" usually implies Master Key.\n         // But let's allow authenticated users to *try* if we implement roles later.\n         return { type: 'user', user }; \n    }\n  }\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AACA;;AAEO,eAAe,kBAAkB,GAAgB;IACtD,sBAAsB;IACtB,MAAM,WAAW,IAAI,OAAO,CAAC,GAAG,CAAC;IACjC,IAAI,YAAY,aAAa,QAAQ,GAAG,CAAC,SAAS,EAAE;QAClD,OAAO;YAAE,MAAM;QAAS;IAC1B;IAEA,qEAAqE;IACrE,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;IACnC,IAAI,YAAY,WAAW,YAAY;QACrC,MAAM,QAAQ,WAAW,KAAK,CAAC,UAAU,CAAC,EAAE;QAC5C,MAAM,OAAO,MAAM,IAAA,8IAAa,EAAC;QACjC,uFAAuF;QACvF,uFAAuF;QACvF,IAAI,MAAM;YACL,gFAAgF;YAChF,4EAA4E;YAC5E,OAAO;gBAAE,MAAM;gBAAQ;YAAK;QACjC;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///Applications/PRINCE/PROJECTS/Hisaab/hisaab-v2/app/api/admin/impersonate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { verifyIdToken } from '../../../../lib/auth'; // Ensure init\nimport { verifyAdminAccess } from '../../../../lib/adminAuth';\nimport * as admin from 'firebase-admin';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const access = await verifyAdminAccess(req);\n    if (!access) {\n       return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { targetUid } = await req.json();\n    if (!targetUid) {\n        return NextResponse.json({ error: 'Target UID required' }, { status: 400 });\n    }\n\n    // Generate Custom Token\n    // 'admin' assumes it has been initialized by the verifyIdToken import side-effect\n    // If not, we might need to ensure init. verifyIdToken call usually ensures it.\n    // To be safe, we can rely on verifyIdToken's file execution.\n    \n    // Note: createCustomToken takes the UID.\n    const customToken = await admin.auth().createCustomToken(targetUid);\n\n    return NextResponse.json({ customToken });\n\n  } catch (error: any) {\n    console.error(\"Impersonation Error:\", error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,uJAAiB,EAAC;QACvC,IAAI,CAAC,QAAQ;YACV,OAAO,gKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,IAAI,IAAI;QACpC,IAAI,CAAC,WAAW;YACZ,OAAO,gKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,wBAAwB;QACxB,kFAAkF;QAClF,+EAA+E;QAC/E,6DAA6D;QAE7D,yCAAyC;QACzC,MAAM,cAAc,MAAM,2MAAU,GAAG,iBAAiB,CAAC;QAEzD,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE;QAAY;IAEzC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}