{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Applications/PRINCE/PROJECTS/Hisaab/hisaab-v2/app/api/requests/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport dbConnect from '../../../../lib/db';\nimport Request from '../../../../models/Request';\nimport { verifyIdToken } from '../../../../lib/auth';\n\nexport async function GET(req: Request) {\n  try {\n    const authHeader = req.headers.get('Authorization');\n    if (!authHeader?.startsWith('Bearer ')) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n    const token = authHeader.split(' ')[1];\n    const decoded = await verifyIdToken(token);\n    \n    if (!decoded) {\n       return NextResponse.json({ error: 'Invalid Token' }, { status: 401 });\n    }\n\n    await dbConnect();\n\n    // Fetch pending requests for this user (by UID or Email)\n    const requests = await Request.find({\n        $or: [\n            { 'toUser.userId': decoded.uid },\n            { 'toUser.email': decoded.email }\n        ],\n        status: 'pending'\n    }).sort({ createdAt: -1 });\n\n    // Separate them for frontend convenience\n    const friendRequests = requests.filter(r => r.type === 'friend').map(r => ({\n        id: r._id.toString(),\n        fromUid: r.fromUser.userId,\n        fromName: r.fromUser.name,\n        fromEmail: r.fromUser.email,\n        fromPhotoURL: r.fromUser.photoURL\n    }));\n\n    const groupInvites = requests.filter(r => r.type === 'group_invite').map(r => ({\n        id: r._id.toString(),\n        groupId: r.groupId,\n        groupName: r.groupName,\n        fromName: r.fromUser.name,\n        groupDetails: { type: 'Group' } // Could fetch actual Group details if needed\n    }));\n\n    // SEED DATA FOR DEMO IF EMPTY (To satisfy \"make with real data\" request immediately for testing)\n    // Only if query param seed=true? No, let's strictly serve DB data.\n    // If empty, frontend shows empty state.\n    \n    return NextResponse.json({ friendRequests, groupInvites });\n\n  } catch (error: any) {\n    console.error(\"API Error:\", error);\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n\n// POST to Handle Accept/Decline (Simple implementation)\nexport async function POST(req: Request) {\n     try {\n        const authHeader = req.headers.get('Authorization');\n        const token = authHeader?.split(' ')[1];\n        if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n        const decoded = await verifyIdToken(token);\n        if (!decoded) return NextResponse.json({ error: 'Invalid Token' }, { status: 401 });\n\n        const body = await req.json();\n        const { requestId, action } = body; // action: 'accepted' | 'declined'\n\n        await dbConnect();\n\n        if (action === 'accepted' || action === 'declined') {\n             await Request.findByIdAndUpdate(requestId, { status: action });\n             // Logic to actually Add Friend or Join Group would go here\n             // For now, just updating status is enough to remove it from \"Pending\" list\n        }\n\n        return NextResponse.json({ success: true });\n     } catch (error: any) {\n        return NextResponse.json({ error: error.message }, { status: 500 });\n     }\n}\n"],"names":[],"mappings":";;;;;;AACA;;;;;;;;;;;;;;;;;;;;AAKO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,IAAI,CAAC,YAAY,WAAW,YAAY;YACtC,OAAO,gKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QACA,MAAM,QAAQ,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;QACtC,MAAM,UAAU,MAAM,cAAc;QAEpC,IAAI,CAAC,SAAS;YACX,OAAO,gKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM;QAEN,yDAAyD;QACzD,MAAM,WAAW,MAAM,QAAQ,IAAI,CAAC;YAChC,KAAK;gBACD;oBAAE,iBAAiB,QAAQ,GAAG;gBAAC;gBAC/B;oBAAE,gBAAgB,QAAQ,KAAK;gBAAC;aACnC;YACD,QAAQ;QACZ,GAAG,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE;QAExB,yCAAyC;QACzC,MAAM,iBAAiB,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,UAAU,GAAG,CAAC,CAAA,IAAK,CAAC;gBACvE,IAAI,EAAE,GAAG,CAAC,QAAQ;gBAClB,SAAS,EAAE,QAAQ,CAAC,MAAM;gBAC1B,UAAU,EAAE,QAAQ,CAAC,IAAI;gBACzB,WAAW,EAAE,QAAQ,CAAC,KAAK;gBAC3B,cAAc,EAAE,QAAQ,CAAC,QAAQ;YACrC,CAAC;QAED,MAAM,eAAe,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,gBAAgB,GAAG,CAAC,CAAA,IAAK,CAAC;gBAC3E,IAAI,EAAE,GAAG,CAAC,QAAQ;gBAClB,SAAS,EAAE,OAAO;gBAClB,WAAW,EAAE,SAAS;gBACtB,UAAU,EAAE,QAAQ,CAAC,IAAI;gBACzB,cAAc;oBAAE,MAAM;gBAAQ,EAAE,6CAA6C;YACjF,CAAC;QAED,iGAAiG;QACjG,mEAAmE;QACnE,wCAAwC;QAExC,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE;YAAgB;QAAa;IAE1D,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF;AAGO,eAAe,KAAK,GAAY;IAClC,IAAI;QACD,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,MAAM,QAAQ,YAAY,MAAM,IAAI,CAAC,EAAE;QACvC,IAAI,CAAC,OAAO,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAC9E,MAAM,UAAU,MAAM,cAAc;QACpC,IAAI,CAAC,SAAS,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;QAEjF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG,MAAM,kCAAkC;QAEtE,MAAM;QAEN,IAAI,WAAW,cAAc,WAAW,YAAY;YAC/C,MAAM,QAAQ,iBAAiB,CAAC,WAAW;gBAAE,QAAQ;YAAO;QAC5D,2DAA2D;QAC3D,2EAA2E;QAChF;QAEA,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC5C,EAAE,OAAO,OAAY;QAClB,OAAO,gKAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACpE;AACL"}}]
}